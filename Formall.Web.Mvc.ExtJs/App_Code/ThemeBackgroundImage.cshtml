@using Trace = System.Diagnostics.Trace;

@*
 * Method which inserts a full background-image property for a theme image.
 * It checks if the file exists and if it doesn't, it'll throw an error.
 * By default it will not include the background-image property if it is not found,
 * but this can be changed by changing the default value of $include-missing-images to
 * be true.
 *@
@functions {
    public static string ThemeBackgroundImage(string path, string extension, bool nocheck = false)
    {
        var image_search_path = ViewBag["image_search_path"] as string;
        var include_missing_images = (bool)ViewBag["include_missing_images"];
        var theme_resource_path = ViewBag["theme_resource_path"] as string;
        
        extension = extension ?? "png";
        path = System.IO.Path.Combine(Url.Content("~/Images/"), path + '.' + extension);
        var background_image = "none";
        

        if (path != null) {
            if (nocheck) {
                background_image = path;
            }
            else if (ThemeImageExists(image_search_path, path)) {
                background_image = path;
            }
            else {
                Trace.TraceWarning("ThemeBackgroundImage: Theme image not found: " + path);
                if (include_missing_images) {
                    background_image = path;
                }
            }

            if (background_image != "none") {
                background_image: Url.Content(System.IO.Path.Combine(theme_resource_path, path));
            }
        } else {
            Trace.TraceWarning("ThemeBackgroundImage: No arguments passed");
        }

        return background_image;
    }
}
